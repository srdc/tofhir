openapi: 3.0.2
info:
  description: "Lists the REST APIs provided by a toFHIR server"
  version: "1.1"
  title: "toFHIR REST API"

servers:
  - url: http://localhost:8085/tofhir
    description: Local deployment of the toFHIR server


tags:
  - name: "Terminology"
    description: "Represents a logical grouping for terminolgy entities with concept maps and code systems"
  - name: "Project"
    description: "Represents a logical grouping for project entities"
  - name: "Schema"
    description: "Represents a logical grouping for schema entities"
  - name: "Mapping"
    description: "Represents a logical grouping for mapping entities"
  - name: "Job"
    description: "Represents a logical grouping for job entities"
  - name: "Execution"
    description: "Represents a logical grouping for job execution entities"
  - name: "Mapping Context"
    description: "Represents a logical grouping for mapping context entities"
  - name: "Fhir Definition"
    description: "Represents a logical grouping for fhir definition entities"
  - name: "Fhir Path Functions"
    description: "Represents a logical grouping for fhir path function entities"


paths:

  # Beginning of the Terminology tag
  /terminologies:
    get:
      tags:
        - "Terminology"
      summary: "Gets all terminologies"
      operationId: "getTerminologies"
      responses:
        '200':
          description: "Successful operation"
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/TerminologySystem"

    post:
      tags:
        - "Terminology"
      summary: "Creates a new terminology"
      operationId: "createTerminology"
      requestBody:
        description: "Terminology details"
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TerminologySystem"
      responses:
        '201':
          description: "Successful operation"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TerminologySystem"
        '400':
          $ref: '#/components/responses/400BadRequest'
        '409':
          $ref: '#/components/responses/409AlreadyExists'

  /terminologies/{terminologyId}:
    get:
      tags:
        - "Terminology"
      summary: "Gets the specified terminology"
      operationId: "getTerminology"
      parameters:
        - $ref: "#/components/parameters/terminologyId"
      responses:
        '200':
          description: "Successful operation"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TerminologySystem"
        '404':
          $ref: "#/components/responses/404NotFound"

    put:
      tags:
        - "Terminology"
      summary: "Updates the specified terminology"
      operationId: "updateTerminology"
      parameters:
        - $ref: "#/components/parameters/terminologyId"
      requestBody:
        description: "Terminology details"
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TerminologySystem"
      responses:
        '200':
          description: "Successful operation"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TerminologySystem"
        '400':
          $ref: '#/components/responses/400BadRequest'
        '404':
          $ref: '#/components/responses/404NotFound'

    delete:
      tags:
        - "Terminology"
      summary: "Deletes the specified terminology"
      operationId: "deleteTerminology"
      parameters:
        - $ref: "#/components/parameters/terminologyId"
      responses:
        '204':
          description: "Successful operation"
        '400':
          $ref: '#/components/responses/400BadRequest'
        '404':
          $ref: '#/components/responses/404NotFound'

  /terminologies/{terminologyId}/concept-maps/:
    get:
      tags:
        - "Terminology"
      summary: "Gets all concept maps for the specified terminology"
      operationId: "getConceptMaps"
      parameters:
        - $ref: "#/components/parameters/terminologyId"
      responses:
        '200':
          description: "Successful operation"
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/TerminologyConceptMap"

  /terminologies/{terminologyId}/concept-maps/{conceptMapId}:
    get:
      tags:
        - "Terminology"
      summary: "Gets the specified concept map for the specified terminology"
      operationId: "getConceptMap"
      parameters:
        - $ref: "#/components/parameters/terminologyId"
        - $ref: "#/components/parameters/conceptMapId"
      responses:
        '200':
          description: "Successful operation"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TerminologyConceptMap"
        '404':
          $ref: "#/components/responses/404NotFound"

  /terminologies/{terminologyId}/concept-maps/{conceptMapId}/content:
    get:
      tags:
        - "Terminology"
      summary: "Gets the paginated content of a specified concept map CSV for the specified terminology"
      operationId: "getConceptMapContent"
      parameters:
        - $ref: "#/components/parameters/terminologyId"
        - $ref: "#/components/parameters/conceptMapId"
        - in: query
          name: page
          schema:
            type: string
          required: false
        - in: query
          name: size
          schema:
            type: string
          required: false
      responses:
        '200':
          description: "Successful operation"
          content:
            text/csv:
              schema:
                type: string
                format: binary
                example: "source_system,source_code,target_system,target_code,target_display,equivalence\nhttp://terminology.hl7.org/CodeSystem/v2-0487,ACNE,http://snomed.info/sct,309068002,Specimen from skin,equivalent\nhttp://terminology.hl7.org/CodeSystem/v2-0487,ACNFLD,http://snomed.info/sct,119323008,Pus specimen,equivalent\nhttp://terminology.hl7.org/CodeSystem/v2-0487,ACNFLD,http://snomed.info/sct,119323009,Pus specimen 2,equivalent\nhttp://terminology.hl7.org/CodeSystem/v2-0487,BULLA,http://snomed.info/sct,258482009,Pus specimen 2,narrower"
        '404':
          $ref: "#/components/responses/404NotFound"

    post:
      tags:
        - "Terminology"
      summary: "Updates the paginated content of the specified concept map CSV for the specified terminology"
      operationId: "updateConceptMapContent"
      parameters:
        - $ref: "#/components/parameters/terminologyId"
        - $ref: "#/components/parameters/conceptMapId"
        - in: query
          name: page
          schema:
            type: string
          required: false
        - in: query
          name: size
          schema:
            type: string
          required: false
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                # 'attachment' will be the field name in this multipart request
                attachment:
                  type: string
                  format: binary
      responses:
        '200':
          description: "Successful operation"
          content:
            text/plain:
              schema:
                type: string
                example: "OK"
        '400':
          $ref: '#/components/responses/400BadRequest'
        '404':
          $ref: "#/components/responses/404NotFound"

  /terminologies/{terminologyId}/concept-maps/{conceptMapId}/header:
    post:
      tags:
        - "Terminology"
      summary: "Updates the header of the specified concept map CSV for the specified terminology"
      operationId: "updateConceptMapHeader"
      parameters:
        - $ref: "#/components/parameters/terminologyId"
        - $ref: "#/components/parameters/conceptMapId"
      requestBody:
        content:
          application/json:
            schema:
              type: array
              items:
                type: string
            example:
              ["column-name1", "column-name2", "column-name3"]
      responses:
        '200':
          description: "Successful operation"
          content:
            text/plain:
              schema:
                type: string
                example: "OK"
        '400':
          $ref: '#/components/responses/400BadRequest'
        '404':
          $ref: "#/components/responses/404NotFound"

  /terminologies/{terminologyId}/concept-maps/{conceptMapId}/file:
    get:
      tags:
        - "Terminology"
      summary: "Gets the whole content of a specified concept map for the specified terminology"
      operationId: "getConceptMapFile"
      parameters:
        - $ref: "#/components/parameters/terminologyId"
        - $ref: "#/components/parameters/conceptMapId"
      responses:
        '200':
          description: "Successful operation"
          content:
            text/csv:
              schema:
                type: string
                format: binary
                example: "source_system,source_code,target_system,target_code,target_display,equivalence\nhttp://terminology.hl7.org/CodeSystem/v2-0487,ACNE,http://snomed.info/sct,309068002,Specimen from skin,equivalent\nhttp://terminology.hl7.org/CodeSystem/v2-0487,ACNFLD,http://snomed.info/sct,119323008,Pus specimen,equivalent\nhttp://terminology.hl7.org/CodeSystem/v2-0487,ACNFLD,http://snomed.info/sct,119323009,Pus specimen 2,equivalent\nhttp://terminology.hl7.org/CodeSystem/v2-0487,BULLA,http://snomed.info/sct,258482009,Pus specimen 2,narrower"
        '404':
          $ref: "#/components/responses/404NotFound"

    post:
      tags:
        - "Terminology"
      summary: "Updates the whole content of the specified concept map for the specified terminology"
      operationId: "updateConceptMapFile"
      parameters:
        - $ref: "#/components/parameters/terminologyId"
        - $ref: "#/components/parameters/conceptMapId"
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                # 'attachment' will be the field name in this multipart request
                attachment:
                  type: string
                  format: binary
      responses:
        '200':
          description: "Successful operation"
          content:
            text/plain:
              schema:
                type: string
                example: "OK"
        '400':
          $ref: '#/components/responses/400BadRequest'
        '404':
          $ref: "#/components/responses/404NotFound"

  /terminologies/{terminologyId}/code-systems:
    get:
      tags:
        - "Terminology"
      summary: "Gets the code systems for the specified terminology"
      operationId: "getCodeSystems"
      parameters:
        - $ref: "#/components/parameters/terminologyId"
      responses:
        '200':
          description: "Successful operation"
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/TerminologyCodeSystem"
        '404':
          $ref: "#/components/responses/404NotFound"

  /terminologies/{terminologyId}/code-systems/{codeSystemId}:
    get:
      tags:
        - "Terminology"
      summary: "Gets the specified code system for the specified terminology"
      operationId: "getCodeSystem"
      parameters:
        - $ref: "#/components/parameters/terminologyId"
        - $ref: "#/components/parameters/codeSystemId"
      responses:
        '200':
          description: "Successful operation"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TerminologyCodeSystem"
        '404':
          $ref: "#/components/responses/404NotFound"

  /terminologies/{terminologyId}/code-systems/{conceptMapId}/content:
    get:
      tags:
        - "Terminology"
      summary: "Gets the paginated content of a specified code system CSV for the specified terminology"
      operationId: "getCodeSystemContent"
      parameters:
        - $ref: "#/components/parameters/terminologyId"
        - $ref: "#/components/parameters/conceptMapId"
        - in: query
          name: page
          schema:
            type: string
          required: false
        - in: query
          name: size
          schema:
            type: string
          required: false
      responses:
        '200':
          description: "Successful operation"
          content:
            text/csv:
              schema:
                type: string
                format: binary
                example: "source_system,source_code,target_system,target_code,target_display,equivalence\nhttp://terminology.hl7.org/CodeSystem/v2-0487,ACNE,http://snomed.info/sct,309068002,Specimen from skin,equivalent\nhttp://terminology.hl7.org/CodeSystem/v2-0487,ACNFLD,http://snomed.info/sct,119323008,Pus specimen,equivalent\nhttp://terminology.hl7.org/CodeSystem/v2-0487,ACNFLD,http://snomed.info/sct,119323009,Pus specimen 2,equivalent\nhttp://terminology.hl7.org/CodeSystem/v2-0487,BULLA,http://snomed.info/sct,258482009,Pus specimen 2,narrower"
        '404':
          $ref: "#/components/responses/404NotFound"

    post:
      tags:
        - "Terminology"
      summary: "Updates the paginated content of the specified code system CSV for the specified terminology"
      operationId: "updateCodeSystemContent"
      parameters:
        - $ref: "#/components/parameters/terminologyId"
        - $ref: "#/components/parameters/conceptMapId"
        - in: query
          name: page
          schema:
            type: string
          required: false
        - in: query
          name: size
          schema:
            type: string
          required: false
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                # 'attachment' will be the field name in this multipart request
                attachment:
                  type: string
                  format: binary
      responses:
        '200':
          description: "Successful operation"
          content:
            text/plain:
              schema:
                type: string
                example: "OK"
        '400':
          $ref: '#/components/responses/400BadRequest'
        '404':
          $ref: "#/components/responses/404NotFound"

  /terminologies/{terminologyId}/code-systems/{codeSystemId}/header:
    post:
      tags:
        - "Terminology"
      summary: "Updates the header of the specified code system CSV for the specified terminology"
      operationId: "getCodeSystemHeader"
      parameters:
        - $ref: "#/components/parameters/terminologyId"
        - $ref: "#/components/parameters/codeSystemId"
      requestBody:
        content:
          application/json:
            schema:
              type: array
              items:
                type: string
            example:
              ["column-name1", "column-name2", "column-name3"]
      responses:
        '200':
          description: "Successful operation"
          content:
            text/plain:
              schema:
                type: string
                example: "OK"
        '400':
          $ref: '#/components/responses/400BadRequest'
        '404':
          $ref: "#/components/responses/404NotFound"

  /terminologies/{terminologyId}/code-systems/{codeSystemId}/file:
    get:
      tags:
        - "Terminology"
      summary: "Gets the whole content for the specified code system for the specified terminology"
      operationId: "getCodeSystemFile"
      parameters:
        - $ref: "#/components/parameters/terminologyId"
        - $ref: "#/components/parameters/codeSystemId"
      responses:
        '200':
          description: "Successful operation"
          content:
            text/csv:
              schema:
                type: string
                format: binary
                example: "code,display,fr,de\n309068002,Specimen from skin,Spécimen de peau,Probe von der Haut\n119323008,Pus specimen,Spécimen de pus,Eiterprobe"
        '404':
          $ref: "#/components/responses/404NotFound"

    post:
      tags:
        - "Terminology"
      summary: "Updates the whole content for the specified code system for the specified terminology"
      operationId: "updateCodeSystemFile"
      parameters:
        - $ref: "#/components/parameters/terminologyId"
        - $ref: "#/components/parameters/codeSystemId"
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                # 'attachment' will be the field name in this multipart request
                attachment:
                  type: string
                  format: binary
      responses:
        '200':
          description: "Successful operation"
          content:
            text/plain:
              schema:
                type: string
                example: "OK"
        '400':
          $ref: '#/components/responses/400BadRequest'
        '404':
          $ref: "#/components/responses/404NotFound"

  # Beginning of the Project tag
  /projects:
    get:
      tags:
        - "Project"
      summary: "Gets all projects"
      operationId: "getProjects"
      responses:
        '200':
          description: "Successful operation"
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Project"

    post:
      tags:
        - "Project"
      summary: "Creates a new project"
      operationId: "createProject"
      requestBody:
        description: "Project details"
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Project"
      responses:
        '201':
          description: "Successful operation"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Project"
        '400':
          $ref: '#/components/responses/400BadRequest'
        '409':
          $ref: '#/components/responses/409AlreadyExists'
        '415':
          $ref: '#/components/responses/415UnsupportedMediaType'

  /projects/{projectId}:
    get:
      tags:
        - "Project"
      summary: "Gets the specified project"
      operationId: "getProject"
      parameters:
        - $ref: '#/components/parameters/projectId'
      responses:
        '200':
          description: "Successful operation"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Project"
        '404':
          $ref: '#/components/responses/404NotFound'

    patch:
      tags:
        - "Project"
      summary: "Updates the project with the given patch"
      operationId: "patchProject"
      parameters:
        - $ref: '#/components/parameters/projectId'
      responses:
        '200':
          description: "Successful operation"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Project"
        '400':
          $ref: '#/components/responses/400BadRequest'
        '404':
          $ref: '#/components/responses/404NotFound'
        '415':
          $ref: '#/components/responses/415UnsupportedMediaType'

    delete:
      tags:
        - "Project"
      summary: "Deletes the specified project"
      operationId: "deleteProject"
      parameters:
        - $ref: '#/components/parameters/projectId'
      responses:
        '204':
          description: "Successful operation"
        '404':
          $ref: '#/components/responses/404NotFound'

  # Beginning the Schema Tag
  /projects/{projectId}/schemas:
    get:
      tags:
        - Schema
      summary: Gets all schemas in a project
      description: "If schema url parameter is given, gets the specified schema otherwise gets all schemas"
      operationId: getSchemas
      parameters:
        - $ref: '#/components/parameters/projectId'
        - $ref: '#/components/parameters/schemaUrl'
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/SchemaDefinition"

    post:
      tags:
        - Schema
      summary: Creates the given schema in a project
      operationId: createSchema
      parameters:
        - $ref: '#/components/parameters/projectId'
        - $ref: '#/components/parameters/format'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              oneOf:
                - $ref: "#/components/schemas/Resource"
                - $ref: "#/components/schemas/SchemaDefinition"
            examples:
              SimpleStructureDefinitionExample:
                $ref: "#/components/examples/SimpleStructureDefinitionExample"
              StructureDefinitionExample:
                $ref: "#/components/examples/StructureDefinitionExample"
        description: Schema data to be created
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SchemaDefinition"

  /projects/{projectId}/schemas/{schemaId}:
    get:
      tags:
        - Schema
      summary: Gets the specified schema in the project
      operationId: getSchema
      parameters:
        - $ref: '#/components/parameters/projectId'
        - $ref: '#/components/parameters/schemaId'
        - $ref: '#/components/parameters/format'
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SchemaDefinition"
        '404':
          $ref: '#/components/responses/404NotFound'

    put:
      tags:
        - Schema
      summary: Updates the schema with the given body
      operationId: putSchema
      parameters:
        - $ref: '#/components/parameters/projectId'
        - $ref: '#/components/parameters/schemaId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SchemaDefinition"
        description: Updated schema data
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SchemaDefinition"
        '400':
          $ref: '#/components/responses/400BadRequest'
        '404':
          $ref: '#/components/responses/404NotFound'

    delete:
      tags:
        - Schema
      summary: Deletes the specified schema
      operationId: deleteSchema
      parameters:
        - $ref: '#/components/parameters/projectId'
        - $ref: '#/components/parameters/schemaId'
      responses:
        '204':
          description: Successful operation
        '404':
          $ref: '#/components/responses/404NotFound'

  /projects/{projectId}/schemas/infer:
    post:
      tags:
        - Schema
      summary: Infers a schema from the given data
      operationId: inferSchema
      parameters:
        - $ref: "#/components/parameters/projectId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/InferTask"
        description: Data for schema inference
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SchemaDefinition"
        '400':
          $ref: '#/components/responses/400BadRequest'

  /projects/{projectId}/schemas/redcap:
    post:
      tags:
        - Schema
      summary: Gets the REDCap Data Dictionary file
      operationId: importREDCapDataDictionary
      parameters:
        - $ref: '#/components/parameters/projectId'
        - $ref: '#/components/parameters/rootUrl'
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                # 'attachment' will be the field name in this multipart request
                attachment:
                  type: string
                  format: binary
        description: REDCap data dictionary file and root URL
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/SchemaDefinition"
        '400':
          $ref: '#/components/responses/400BadRequest'

  # Beginning of the Mappings tag
  /projects/{projectId}/mappings:
    get:
      tags:
        - Mapping
      summary: Gets all mappings in the project
      parameters:
        - $ref: '#/components/parameters/projectId'
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/FhirMapping"
        '400':
          $ref: '#/components/responses/400BadRequest'

    post:
      tags:
        - Mapping
      summary: Creates a mapping in the project
      parameters:
        - $ref: '#/components/parameters/projectId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/FhirMapping"
        description: Fhir mappping to be created
      responses:
        '201':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FhirMapping"
        '400':
          $ref: '#/components/responses/400BadRequest'
        '415':
          $ref: '#/components/responses/415UnsupportedMediaType'
        '409':
          $ref: '#/components/responses/409AlreadyExists'

  /projects/{projectId}/mappings/{mappingId}:
    get:
      tags:
        - Mapping
      summary: Gets the specified mapping
      parameters:
        - $ref: '#/components/parameters/projectId'
        - $ref: '#/components/parameters/mappingId'
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FhirMapping"
        '400':
          $ref: '#/components/responses/400BadRequest'
        '404':
          $ref: '#/components/responses/404NotFound'

    put:
      tags:
        - Mapping
      summary: Updates the mapping with the given body
      parameters:
        - $ref: '#/components/parameters/projectId'
        - $ref: '#/components/parameters/mappingId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/FhirMapping"
        description: Fhir mappping to update current mapping
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FhirMapping"
        '400':
          $ref: '#/components/responses/400BadRequest'
        '415':
          $ref: '#/components/responses/415UnsupportedMediaType'
        '404':
          $ref: '#/components/responses/404NotFound'

    delete:
      tags:
        - Mapping
      summary: Deletes the specified mapping
      operationId: deleteMapping
      parameters:
        - $ref: '#/components/parameters/projectId'
        - $ref: '#/components/parameters/mappingId'
      responses:
        '204':
          description: Successful operation
        '404':
          $ref: '#/components/responses/404NotFound'

  # Beginning of the Job tag
  /projects/{projectId}/jobs:
    get:
      tags:
        - Job
      summary: Gets all mapping jobs in the project
      parameters:
        - $ref: "#/components/parameters/projectId"
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/FhirMappingJob"
        '400':
          $ref: '#/components/responses/400BadRequest'

    post:
      tags:
        - Job
      summary: Creates a new mapping job
      parameters:
        - $ref: "#/components/parameters/projectId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/FhirMappingJob"
        description: Fhir mappping job to be created
      responses:
        '201':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FhirMappingJob"
        '400':
          $ref: '#/components/responses/400BadRequest'
        '415':
          $ref: '#/components/responses/415UnsupportedMediaType'

  /projects/{projectId}/jobs/{jobId}:
    get:
      tags:
        - Job
      summary: Gets the specified mapping job
      parameters:
        - $ref: "#/components/parameters/projectId"
        - $ref: "#/components/parameters/jobId"
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FhirMappingJob"
        '404':
          $ref: '#/components/responses/404NotFound'

    put:
      tags:
        - Job
      summary: Updates the mapping job with the given body
      parameters:
        - $ref: "#/components/parameters/projectId"
        - $ref: "#/components/parameters/jobId"
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/FhirMappingJob"
      responses:
        '200':
          description: Mapping job updated successfully
        '404':
          $ref: '#/components/responses/404NotFound'
        '400':
          $ref: '#/components/responses/400BadRequest'
        '415':
          $ref: '#/components/responses/415UnsupportedMediaType'

    delete:
      tags:
        - Job
      summary: Deletes the mapping job
      parameters:
        - $ref: "#/components/parameters/projectId"
        - $ref: "#/components/parameters/jobId"
      responses:
        '204':
          description: Mapping job deleted successfully
        '400':
          description: The running mapping jobs cannot be deleted
        '404':
          $ref: '#/components/responses/404NotFound'

  /projects/{projectId}/jobs/{jobId}/run:
    post:
      tags:
        - Job
      summary: Runs the mapping job
      parameters:
        - $ref: "#/components/parameters/projectId"
        - $ref: '#/components/parameters/jobId'
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ExecuteJobTask"
      responses:
        '200':
          description: Job execution started successfully
        '400':
          $ref: "#/components/responses/400BadRequest"

  /projects/{projectId}/jobs/{jobId}/status:
    get:
      tags:
        - Job
      summary: Checks whether the mapping job is running or not
      parameters:
        - $ref: "#/components/parameters/projectId"
        - $ref: '#/components/parameters/jobId'
      responses:
        '200':
          description: Mapping job is running
        '404':
          description: Mapping job not found or not running

  /projects/{projectId}/jobs/{jobId}/test:
    post:
      tags:
        - Job
      summary: Tests the mapping job with the given configurations
      parameters:
        - $ref: "#/components/parameters/projectId"
        - $ref: "#/components/parameters/jobId"
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TestResourceCreationRequest"
      responses:
        '200':
          description: Test completed successfully

  # Beginning of the Execution tag
  /projects/{projectId}/jobs/{jobId}/executions:
    get:
      tags:
        - Execution
      summary: Gets executions of the mapping job
      parameters:
        - $ref: "#/components/parameters/projectId"
        - $ref: "#/components/parameters/jobId"
        # Filter parameters for lazy load
        - name: page
          in: query
          required: true
          description: requested page of the executions
          schema:
            type: integer
            example: 1
        - name: dateBefore
          in: query
          required: false
          description: Executions started before this date
          schema:
            type: string
        - name: dateAfter
          in: query
          required: false
          description: Executions started after this date
          schema:
            type: string
        - name: errorStatuses
          in: query
          required: false
          description: Request type of executions written as comma seperated
          schema:
            type: string

      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Execution"

    delete:
      tags:
        - Execution
      summary: Stops executions of the mapping job
      parameters:
        - $ref: "#/components/parameters/projectId"
        - $ref: "#/components/parameters/jobId"
      responses:
        '200':
          description: Executions stopped successfully
        '404':
          $ref: "#/components/responses/404NotFound"


  /projects/{projectId}/jobs/{jobId}/executions/{executionId}:
    get:
      tags:
        - Execution
      summary: Gets the details of the specified execution
      parameters:
        - $ref: "#/components/parameters/projectId"
        - $ref: "#/components/parameters/jobId"
        - $ref: "#/components/parameters/executionId"
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Execution"
        '404':
          $ref: "#/components/responses/404NotFound"

  /projects/{projectId}/jobs/{jobId}/executions/{executionId}/logs:
    get:
      tags:
        - Execution
      summary: Gets execution logs
      parameters:
        - $ref: "#/components/parameters/projectId"
        - $ref: "#/components/parameters/jobId"
        - $ref: "#/components/parameters/executionId"
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Log"
        '404':
          $ref: "#/components/responses/404NotFound"

  /projects/{projectId}/jobs/{jobId}/executions/{executionId}/run:
    post:
      tags:
        - Execution
      summary: Continues the job execution
      parameters:
        - $ref: "#/components/parameters/projectId"
        - $ref: "#/components/parameters/jobId"
        - $ref: "#/components/parameters/executionId"
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ExecuteJobTask"
      responses:
        '200':
          description: Job execution runned successfully

  /projects/{projectId}/jobs/{jobId}/executions/{executionId}/stop:
    delete:
      tags:
        - Execution
      summary: Stops the job execution
      parameters:
        - $ref: "#/components/parameters/projectId"
        - $ref: "#/components/parameters/jobId"
        - $ref: "#/components/parameters/executionId"
      responses:
        '200':
          description: Job execution stopped successfully

  /projects/{projectId}/jobs/{jobId}/executions/{executionId}/mappings/{mappingUrl}/stop:
    delete:
      tags:
        - Execution
      parameters:
        - $ref: "#/components/parameters/projectId"
        - $ref: "#/components/parameters/jobId"
        - $ref: "#/components/parameters/executionId"
        - $ref: "#/components/parameters/mappingUrl"
      summary: Stops the individual mapping task inside the job
      responses:
        '200':
          description: Mapping execution stopped successfully

  # Beginning of the Mapping Context tag
  /projects/{projectId}/mapping-contexts:
    get:
      tags:
        - Mapping Context
      summary: Gets all mapping contexts in the project
      parameters:
        - $ref: "#/components/parameters/projectId"
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              example:
                ["anesthesia-observations-concept-map.csv",
                 "anesthesia-procedures-concept-map.csv",
                 "anesthesia-types-concept-map.csv"]

    post:
      tags:
        - Mapping Context
      summary: Creates a new mapping context
      parameters:
        - $ref: "#/components/parameters/projectId"
      requestBody:
        content:
          text/plain:
            schema:
              type: string
              example: "anesthesia-types-concept-map.csv"
      responses:
        '201':
          description: Successful operation
          content:
            application/json:
              schema:
                type: string
                example: "anesthesia-types-concept-map.csv"
        '400':
          $ref: "#/components/responses/400BadRequest"

  /projects/{projectId}/mapping-contexts/{mappingContextId}:
    delete:
      tags:
        - Mapping Context
      summary: Deletes the mapping context
      parameters:
        - $ref: "#/components/parameters/projectId"
        - $ref: "#/components/parameters/mappingContextId"
      responses:
        '204':
          description: No content
        '404':
          $ref: "#/components/responses/404NotFound"

  /projects/{projectId}/mapping-contexts/{mappingContextId}/content:
    get:
      tags:
        - "Mapping Context"
      summary: "Gets the paginated content of a mapping context CSV"
      operationId: "getMappingContextContent"
      parameters:
        - $ref: "#/components/parameters/projectId"
        - $ref: "#/components/parameters/mappingContextId"
        - in: query
          name: page
          schema:
            type: string
          required: false
        - in: query
          name: size
          schema:
            type: string
          required: false
      responses:
        '200':
          description: "Successful operation"
          content:
            text/csv:
              schema:
                type: string
                format: binary
                example: "source_system,source_code,target_system,target_code,target_display,equivalence\nhttp://terminology.hl7.org/CodeSystem/v2-0487,ACNE,http://snomed.info/sct,309068002,Specimen from skin,equivalent\nhttp://terminology.hl7.org/CodeSystem/v2-0487,ACNFLD,http://snomed.info/sct,119323008,Pus specimen,equivalent\nhttp://terminology.hl7.org/CodeSystem/v2-0487,ACNFLD,http://snomed.info/sct,119323009,Pus specimen 2,equivalent\nhttp://terminology.hl7.org/CodeSystem/v2-0487,BULLA,http://snomed.info/sct,258482009,Pus specimen 2,narrower"
        '404':
          $ref: "#/components/responses/404NotFound"

    post:
      tags:
        - "Mapping Context"
      summary: "Updates the paginated content of a mapping context CSV"
      operationId: "updateMappingContextContent"
      parameters:
        - $ref: "#/components/parameters/projectId"
        - $ref: "#/components/parameters/mappingContextId"
        - in: query
          name: page
          schema:
            type: string
          required: false
        - in: query
          name: size
          schema:
            type: string
          required: false
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                # 'attachment' will be the field name in this multipart request
                attachment:
                  type: string
                  format: binary
      responses:
        '200':
          description: "Successful operation"
          content:
            text/plain:
              schema:
                type: string
                example: "OK"
        '400':
          $ref: '#/components/responses/400BadRequest'
        '404':
          $ref: "#/components/responses/404NotFound"

  /projects/{projectId}/mapping-contexts/{mappingContextId}/header:
    post:
      tags:
        - "Mapping Context"
      summary: "Updates the header of mapping context CSV"
      operationId: "updateMappingContextHeader"
      parameters:
        - $ref: "#/components/parameters/projectId"
        - $ref: "#/components/parameters/mappingContextId"
      requestBody:
        content:
          application/json:
            schema:
              type: array
              items:
                type: string
            example:
              ["column-name1", "column-name2", "column-name3"]
      responses:
        '200':
          description: "Successful operation"
          content:
            text/plain:
              schema:
                type: string
                example: "OK"
        '400':
          $ref: '#/components/responses/400BadRequest'
        '404':
          $ref: "#/components/responses/404NotFound"


  /projects/{projectId}/mapping-contexts/{mappingContextId}/file:
    post:
      tags:
        - Mapping Context
      summary: Uploads the given mapping context file
      parameters:
        - $ref: "#/components/parameters/projectId"
        - $ref: "#/components/parameters/mappingContextId"
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                attachment:
                  type: string
                  format: binary
      responses:
        '200':
          description: File uploaded successfully
        '400':
          description: Bad request

    get:
      tags:
        - Mapping Context
      summary: Downloads the mapping context file
      parameters:
        - $ref: "#/components/parameters/projectId"
        - $ref: "#/components/parameters/mappingContextId"
      responses:
        '200':
          description: File downloaded successfully
          content:
            text/csv:
              schema:
                type: string
                format: binary
                example: "source_code,source_system,source_display\n50697003,http://snomed.info/sct,General Anesthesia\n386761002,http://snomed.info/sct,Local Anesthesia\n27372005,http://snomed.info/sct,Regional Anesthesia\n231249005,http://snomed.info/sct,Spinal Anesthesia\n88815003,http://snomed.info/sct,Peripheral block anesthesia\n26402001,http://snomed.info/sct,Nerve block anesthesia\n72641008,http://snomed.info/sct,Sedation"
        '404':
          $ref: "#/components/responses/404NotFound"

  # Beginning of the Fhir Definition tag
  /fhir-definitions:
    get:
      tags:
        - Fhir Definition
      summary: Gets FHIR Definitions
      parameters:
        - $ref: "#/components/parameters/q"
        - $ref: "#/components/parameters/rtype"
        - $ref: "#/components/parameters/profile"
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/SimpleStructureDefinition'
        '400':
          $ref: "#/components/responses/400BadRequest"

  /validate:
    post:
      tags:
        - Fhir Definition
      summary: Validates the FHIR resource whose validation url is given
      parameters:
        - $ref: "#/components/parameters/fhirValidationUrl"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Resource"
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: object
              examples:
                FhirValidationExample:
                  $ref: "#/components/examples/FhirValidationExample"
        '400':
          description: Missing query parameter
        '500':
          description: Proxy request failed

  # Beginning of the Fhir Path Functions tag
  /fhir-path-functions:
    get:
      tags:
        - Fhir Path Functions
      summary: Returns the documentations of Fhir path functions
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FhirPathFunction"
              examples:
                FhirPathFunctionsExample:
                  $ref: "#/components/examples/FhirPathFunctionsExample"

  # Beginning of the File System Path tag
  /file-system-path:
    get:
      tags:
        - File System Path
      summary: Returns a tree structure of the file system, with the root being the context path where toFHIR runs.
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FilePathNode"
              examples:
                FilePathNodeExample:
                  $ref: "#/components/examples/FilePathNodeExample"
  # Beginning of the metadata tag
  /metadata:
    get:
      tags:
        - Metadata
      summary: Return metadata information of the server including version, config etc.
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Metadata"
              examples:
                MetadataExample:
                  $ref: "#/components/examples/MetadataExample"


components:
  # Type definitions for the objects used
  schemas:
    TerminologySystem:
      type: object
      required:
        - name
        - description
      properties:
        id:
          type: string
          description: "Identifier of the terminology system"
        name:
          type: string
          description: "Name of the terminology system"
          example: "T-System Example"
        description:
          type: string
          description: "Description of the terminology system"
          example: "SNOMED CT is a terminology system for clinical health care"
        conceptMaps:
          type: array
          items:
            $ref: "#/components/schemas/TerminologyConceptMap"
          description: "URL of the terminology system"
        codeSystems:
          type: array
          items:
            $ref: "#/components/schemas/TerminologyCodeSystem"
          description: "Version of the terminology system"

    TerminologyConceptMap:
      type: object
      required:
        - name
        - conceptMapUrl
        - sourceValueSetUrl
        - targetValueSetUrl
      properties:
        id:
          type: string
          description: "Identifier of the terminology concept map"
          pattern: "[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}"
        name:
          type: string
          description: "Name of the terminology concept map"
          example: "CoonceptMap"
        conceptMapUrl:
          type: string
          description: "URL of the terminology concept map"
          example: "http://example.com/fhir/ConceptMap/sample1"
        sourceValueSetUrl:
          type: string
          description: "URL of the source value set"
          example: "http://terminology.hl7.org/ValueSet/v2-0487"
        targetValueSetUrl:
          type: string
          description: "URL of the target value set"
          example: "http://snomed.info/sct?fhir_vs"

    TerminologyCodeSystem:
      type: object
      required:
        - name
        - codeSystemUrl
        - valueSetUrl
      properties:
        id:
          type: string
          description: "Identifier of the terminology code system"
          pattern: "[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}"
        name:
          type: string
          description: "Name of the terminology code system"
          example: "CodeSystem"
        codeSystem:
          type: string
          description: "Code system of the terminology code system"
          example: "http://snomed.info/sct"

    Project:
      type: "object"
      required:
        - id
        - name
        - url
      properties:
        id:
          type: "string"
          description: "Identifier of the project"
          pattern: "[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}"
        url:
          type: string
          description: "Url of the project derived from the name"
          example: "www.ProjectName.com"

        name:
          type: "string"
          description: "Name of the project"
          example: "ProjectName"
        description:
          type: "string"
          description: "Description of the project"

    SchemaDefinition:
      type: "object"
      required:
        - "url"
        - "type"
        - "name"
      properties:
        id:
          type: "string"
          description: "Identifier of the schema"
          pattern: "[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}"
        url:
          type: "string"
          description: "Url of the schema"
          example: "https://aiccelerate.eu/fhir/StructureDefinition/Ext-plt1-anesthesia-observations"
        type:
          type: "string"
          description: "Type of the schema"
          example: "Ext-plt1-anesthesia-observations"
        name:
          type: "string"
          description: "Name of the schema"
          example: "Ext-plt1-anesthesia-observations"
        rootDefinition:
          $ref: '#/components/schemas/SimpleStructureDefinition'

        fieldDefinitions:
          type: array
          items:
            $ref: '#/components/schemas/SimpleStructureDefinition'

    SimpleStructureDefinition:
      type: "object"
      required:
        - "id"
        - "path"
        - "isPrimitive"
        - "isChoiceRoot"
        - "isArray"
        - "minCardinality"
      properties:
        id:
          type: string
        path:
          type: string
        dataTypes:
          type: array
          items:
            $ref: '#/components/schemas/DataTypeWithProfiles'
        isPrimitive:
          type: boolean
        isChoiceRoot:
          type: boolean
        isArray:
          type: boolean
        minCardinality:
          type: integer
        maxCardinality:
          type: integer
        boundToValueSet:
          type: string
        isValueSetBindingRequired:
          type: boolean
        referencableProfiles:
          type: array
          items:
            type: string
        constraintDefinitions:
          type: array
          items:
            $ref: '#/components/schemas/ConstraintDefinition'
        sliceDefinition:
          $ref: '#/components/schemas/SliceDefinition'
        sliceName:
          type: string
        fixedValue:
          type: string
        patternValue:
          type: string
        referringTo:
          type: string
        short:
          type: string
        definition:
          type: string
        comment:
          type: string
        elements:
          type: array
          items:
            $ref: '#/components/schemas/SimpleStructureDefinition'

    DataTypeWithProfiles:
      type: "object"
      required:
        - "dataType"
      properties:
        dataType:
          type: "string"
        profiles:
          type: array
          items:
            type: string

    ConstraintDefinition:
      type: object
      required:
        - key
        - desc
        - isWarning
      properties:
        key:
          type: string
        desc:
          type: string
        isWarning:
          type: boolean

    SliceDefinition:
      type: object
      required:
        - discriminators
        - ordered
        - rule
      properties:
        discriminators:
          type: array
          items:
            $ref: '#/components/schemas/SliceDiscriminator'
        ordered:
          type: boolean
        rule:
          type: string

    SliceDiscriminator:
      type: object
      required:
        - type
        - path
      properties:
        type:
          type: string
        path:
          type: string

    Resource:
      type: object
      required:
        - url
        - type
      properties:
        id:
          type: "string"
          description: "Identifier of the schema"
          pattern: "[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}"
        url:
          type: "string"
          description: "Url of the schema"
          example: "https://aiccelerate.eu/fhir/StructureDefinition/Ext-plt1-anesthesia-observations"
        resourceType:
          type: "string"
          description: "Resource type of the schema"
          example: "Ext-plt1-anesthesia-observations"
        name:
          type: "string"
          description: "Name of the schema"
          example: "Ext-plt1-anesthesia-observations"
        status:
          type: "string"
          description: "Publication status of the StructureDefinition"
          example: "draft"
        fhirVersion:
          type: "string"
          description: "version of the FHIR standart"
          example: "4.0.1"
        kind:
          type: "string"
          description: "Kind of the Structure Definition"
          example: "logical"
        abstract:
          type: "boolean"
          description: "Indicates whether this StructureDefinition represents an abstract type"
          example: false
        baseDefinition:
          type: "string"
          description: "Specifies the base or foundational definition upon which this StructureDefinition is built"
          example: "http://hl7.org/fhir/StructureDefinition/Element"
        derivation:
          type: "string"
          description: "The method by which this StructureDefinition is derived"
          example: "specialization"
        differential:
          properties:
            element:
              type: "array"
              items:
                $ref: "#/components/schemas/ElementDefinition"

    ElementDefinition:
      type: object
      description: "The definition of an element in a resource or an extension"
      properties:
        id:
          type: string
        path:
          type: string
        min:
          type: string
        max:
          type: string
        definition:
          type: string
        short:
          type: string
        type:
          type: array
          items:
            type: object
            properties:
              code:
                type: string
              profile:
                type: array
                items:
                  type: string

    InferTask:
      type: object
      properties:
        name:
          type: string
          description: "Name for source binding"
          example: "source"
        sourceSettings:
          $ref: '#/components/schemas/MappingJobSourceSettings'
        sourceBinding:
          oneOf:
            - $ref: "#/components/schemas/FileSystemSource"
            - $ref: "#/components/schemas/SqlSource"
            - $ref: "#/components/schemas/KafkaSource"
      required:
        - name
        - sourceSettings
        - sourceBinding

    MappingJobSourceSettings:
      type: object
      description: Factory class for creating a data source from a JSON object"
      properties:
        source:
          oneOf:
            - $ref: "#/components/schemas/FileSystemSourceSettings"
            - $ref: "#/components/schemas/SqlSourceSettings"
            - $ref: "#/components/schemas/KafkaSourceSettings"
      required:
        - source

    BaseDataSource:
      type: object
      description: "Base class for data sources."
      properties:
        name:
          type: string
          description: "Human friendly name for the source organization for data source"
          example: "pilot2-source"
        sourceUri:
          type: string
          description: "Computer friendly canonical url indicating the source of the data (May be used for Resource.meta.source)"
          example: "https://aiccelerate.eu/data-integration-suite/pilot2-data"
        asStream:
          type: boolean
          description: "Indicates whether the source is a stream or not"
        jsonClass:
          type: string
          description: "Indicates the type of the data source (ex: FileSystemSourceSettings, SqlSourceSettings, KafkaSourceSettings)"
          enum:
            - FileSystemSourceSettings
            - SqlSourceSettings
            - KafkaSourceSettings
      required:
        - name
        - sourceUri
        - asStream
        - jsonClass

    FileSystemSourceSettings:
      description: "Context/configuration for the source of the mapping-job that will read the source data from a file system"
      allOf:
        - $ref: '#/components/schemas/BaseDataSource'
        - type: object
          properties:
            dataFolderPath:
              type: string
              description: "The data folder path of the file source"
              example: "D:/codes/onfhir-io/tofhir/data"
          required:
            - dataFolderPath

    SqlSourceSettings:
      description: "Context/configuration for the source of the mapping-job that will read the source data from a SQL source"
      allOf:
        - $ref: '#/components/schemas/BaseDataSource'
        - type: object
          properties:
            databaseUrl:
              type: string
              description: "Connection URL of the SQL database"
              example: "jdbc:postgresql://localhost:5432/db_name"
            username:
              type: string
              description: "Username of the SQL database"
              example: "postgres"
            password:
              type: string
              description: "Password of the SQL database"
              example: "postgres"
          required:
            - databaseUrl
            - username
            - password

    KafkaSourceSettings:
      description: "Context/configuration for the source of the mapping-job that will read the source data from a kafka as stream"
      allOf:
        - $ref: '#/components/schemas/BaseDataSource'
        - type: object
          properties:
            bootstrapServers:
              description: "Kafka bootstrap server(s) with port, may be comma seperated list (localhost:9092,localhost:9091)"
              type: string
            asRedCap:
              description: "Indicate whether it is a RedCap source"
              type: boolean
          required:
            - bootstrapServers

    MappingBase:
      type: object
      properties:
        jsonClass:
          type: string
          enum:
            - FileSystemSource
            - SqlSource
            - KafkaSource
          description: "Indicates the type of the mapping (e.g., FileSystemSource, SqlSource, KafkaSource)"
        preprocessSql:
          type: string
          description: "Indicates preprocess SQL query"
          example: ""
        options:
          type: object
          description: "Indicates Spark options for the mapping"
      required:
        - jsonClass

    FileSystemSource:
      description: "Defines file system source configurations of a mapping in the mapping-job"
      allOf:
        - $ref: '#/components/schemas/MappingBase'
        - type: object
          properties:
            path:
              type: string
              description: "Path of the file inside the data folder"
              example: "C:\\ToFhir"
            fileFormat:
              type: string
              enum:
                - csv
                - tsv
                - parquet
                - json
              description: "File format of configured file inside of the data folder"
          required:
            - path

    SqlSource:
      description: "Defines SQL source configurations of a mapping in the mapping-job"
      allOf:
        - $ref: '#/components/schemas/MappingBase'
        - type: object
          properties:
            tableName:
              type: string
              description: "Table name of the SQL source"
              example: "table1"
            query:
              type: string
              description: "Query to execute in the database"
              example: "SELECT * FROM table1"

    KafkaSource:
      description: "Defines Kafka source configurations of a mapping in the mapping-job"
      allOf:
        - $ref: '#/components/schemas/MappingBase'
        - type: object
          properties:
            topicName:
              type: string
              description: "Topic(s) to subscribe, may be comma seperated string list (topic1,topic2)"
            groupId:
              type: string
              description: "Kafka group id to use in Kafka consumer while reading from Kafka"
            startingOffsets:
              type: string
              description: "The start point when a query is started"
          required:
            - topicName
            - groupId
            - startingOffsets

    FhirMapping:
      type: object
      properties:
        id:
          type: string
          description: Unique identifier for the mapping
          example: "anesthesia-observations-mapping"
        url:
          type: string
          description: Canonical URL for the mapping
          example: "https://aiccelerate.eu/fhir/mappings/pilot1/anesthesia-observations-mapping"
        name:
          type: string
          description: Computer-friendly name
          example: "anesthesia-observations-mapping"
        title:
          type: string
          description: Human-friendly title
          example: "Mapping of schema anesthesia observations symptoms to AIC-AnesthesiaObservation profile resources"
        description:
          type: string
          description: Description of the mapping
          example: ""
        source:
          type: array
          items:
            $ref: "#/components/schemas/FhirMappingSource"
          description: Metadata about source for the mapping
        variable:
          type: array
          items:
            $ref: "#/components/schemas/FhirExpression"
          description: "Common variables calculated from source data to use in the mappings"
        mapping:
          type: array
          items:
            $ref: "#/components/schemas/FhirMappingExpression"
          description: Mapping scripts
        context:
          type: object
          additionalProperties:
            $ref: "#/components/schemas/FhirMappingContextDefinition"
          description: "Further context to use for mapping evaluation e.g., ConceptMap for terminology mapping, definition of unit conversion functions"
      required:
        - id
        - url
        - name

    FhirMappingExpression:
      type: object
      properties:
        precondition:
          allOf:
            - $ref: "#/components/schemas/FhirExpression"
          description: A precondition FHIR expression for this mapping
        expression:
          allOf:
            - $ref: "#/components/schemas/FhirExpression"
          description: FHIR expression that defines the mappinge
          example:
            $ref: "#/components/examples/FhirExpressionExample/value"
        fhirInteraction:
          allOf:
            - $ref: "#/components/schemas/FhirInteraction"
          description: "Provides information about the FHIR Interaction to persist the mapped information. If not given FHIR Update interaction is used and the mapped content is expected to be a FHIR resource."
      required:
        - expression

    FhirExpression:
      type: object
      properties:
        name:
          type: string
          description: Name of the expression
          example: "encType"
        language:
          type: string
          description: Language of the expression
          example: "text/fhirpath"
        expression:
          type: string
          description: Expression string
          example: "type.utl:split('-').first()"
        reference:
          type: string
          description: Reference to the expression
        value:
          type: object
          description: Defined value of the expression
      required:
        - name
        - language

    FhirMappingSource:
      type: object
      properties:
        alias:
          type: string
          description: "Name of the source to be used in expressions"
          example: "source"
        url:
          type: string
          description: "URL to the StructureDefinition of the source format"
          example: "https://aiccelerate.eu/fhir/StructureDefinition/Ext-plt1-anesthesia-observations"
        joinOn:
          type: array
          items:
            type: string
          description: "Columns to use from this source data while joining the multiple sources"
        description:
          type: string
          description: "Description of the source"
      required:
        - alias
        - url

    FhirMappingContextDefinition:
      type: object
      properties:
        category:
          type: string
          description: Category of context
          example: "concept-map"
        url:
          type: string
          description: URL if context data will be loaded from a URL
          example: "$CONTEXT_REPO/pilot1/anesthesia-observations-concept-map.csv"
        value:
          type: object
          description: Value if context data will be supplied as JSON content
        description:
          type: string
          description: Description of the context data
      required:
        - category

    FhirInteraction:
      description: "Provides the details about FHIR interaction to persist the new information"
      type: object
      properties:
        type:
          type: string
          description: "FHIR interaction type e.g. create | update | patch"
          example: "create"
        rid:
          type: string
          description: "Only required for FHIR Patch and provides either FHIR resource locator"
          example: "Observation/315653"
        condition:
          type: string
          description: "FHIR search statement indicating the condition to update or create"
      required:
        - type

    FhirMappingJob:
      type: object
      properties:
        id:
          type: string
          example: "pilot-example"
        name:
          type: string
          example: "pilot-example"
        sourceSettings:
          $ref: "#/components/schemas/MappingJobSourceSettings"
        sinkSettings:
          $ref: "#/components/schemas/FhirSinkSettings"
        terminologyServiceSettings:
          oneOf:
            - $ref: "#/components/schemas/LocalFhirTerminologyServiceSettings"
        identityServiceSettings:
          allOf:
            - $ref: "#/components/schemas/FhirSinkSettings"
          description: "Interface for settings for identity service"
        mappings:
          type: array
          items:
            $ref: "#/components/schemas/FhirMappingTask"
        schedulingSettings:
          $ref: "#/components/schemas/SchedulingSettings"
        dataProcessingSettings:
          $ref: "#/components/schemas/DataProcessingSettings"
        useFhirSinkAsIdentityService:
          type: boolean
      required:
        - id
        - sinkSettings
        - sourceSettings
        - mappings

    FhirSinkSettings:
      type: object
      description: "Common interface for sink settings"
      oneOf:
        - $ref: "#/components/schemas/FhirRepositorySinkSettings"
        - $ref: "#/components/schemas/FileSystemSinkSettings"

    FileSystemSinkSettings:
      type: object
      description: "Settings to write mapped FHIR resources to file system"
      properties:
        jsonClass:
          type: string
          example: "FileSystemSinkSettings"
        path:
          type: string
          description: "Path to the folder or file to write the resources"
        fileFormat:
          type: string
          description: "File format if not inferred from the path"
        numOfPartitions:
          type: integer
          description: "Number of partitions for the file (for distributed fs)"
        options:
          type: string
          description: "Further options (Spark data source write options)"
      required:
        - jsonClass
        - path

    FhirRepositorySinkSettings:
      type: object
      description: "Settings for a FHIR repository to store the mapped resources"
      properties:
        jsonClass:
          type: string
          example: "FhirRepositorySinkSettings"
        fhirRepoUrl:
          type: string
          description: "Path to the folder or file to write the resources"
          example: "http://localhost:8081/fhir"
        securitySettings:
          type: object
          description: "File format if not inferred from the path"
          oneOf:
            - $ref: "#/components/schemas/BearerTokenAuthorizationSettings"
            - $ref: "#/components/schemas/BasicAuthenticationSettings"
            - $ref: "#/components/schemas/FixedTokenAuthenticationSettings"
        returnMinimal:
          type: boolean
          description: "Number of partitions for the file (for distributed fs)"
      required:
        - jsonClass
        - fhirRepoUrl

    BearerTokenAuthorizationSettings:
      type: object
      description: "Security settings for FHIR API access via bearer token"
      properties:
        jsonClass:
          type: string
          description: "Type of the security setting choice"
          example: "BearerTokenAuthorizationSettings"
        clientId:
          type: string
          description: "OpenID Client identifier assigned to toFhir"
        clientSecret:
          type: string
          description: "OpenID Client secret given to toFhir"
        requiredScopes:
          type: array
          items:
            type: string
          description: "List of required scores to write the resources"
        authzServerTokenEndpoint:
          type: string
          description: "Authorization servers token endpoint"
        clientAuthenticationMethod:
          type: string
          description: "Client authentication method"
      required:
        - clientId
        - clientSecret
        - requiredScopes
        - authzServerTokenEndpoint

    BasicAuthenticationSettings:
      type: object
      description: "Security settings for FHIR API access via basic authentication"
      properties:
        jsonClass:
          type: string
          description: "Type of the security setting choice"
        username:
          type: string
          description: "Username for basic authentication"
        password:
          type: string
          description: "Password for basic authentication"
      required:
        - username
        - password

    FixedTokenAuthenticationSettings:
      type: object
      description: "Security settings for FHIR API access via fixed token"
      properties:
        jsonClass:
          type: string
          description: "Type of the security setting choice"
        token:
          type: string
          description: "The fixed token"
      required:
        - token

    LocalFhirTerminologyServiceSettings:
      type: object
      description: "A local terminology service where each concept map is provided via a CSV file"
      properties:
        jsonClass:
          type: string
          description: "Type of the terminology service, (remote or local)"
          example: "LocalFhirTerminologyServiceSettings"
        folderPath:
          type: string
          description: "Path to the folder that all concept map files exists"
          example: "D:/codes/onfhir-io/tofhir/data"
        conceptMapFiles:
          type: array
          items:
            $ref: '#/components/schemas/ConceptMapFile'
        codeSystemFiles:
          type: array
          items:
            $ref: '#/components/schemas/CodeSystemFile'
      required:
        - folderPath

    ConceptMapFile:
      type: object
      description: "Metadata for a Concept map file for toFhir local terminology service"
      properties:
        id:
          type: string
          description: "unique id"
        name:
          type: string
          description: "Name of the file"
        conceptMapUrl:
          type: string
          description: "Corresponding concept map url e.g. http://cds-hooks.hl7.org/ConceptMap/indicator-to-request-priority"
        sourceValueSetUrl:
          type: string
          description: "Url for Source value set"
        targetValueSetUrl:
          type: string
          description: "Url for Target value set"
      required:
        - name
        - conceptMapUrl
        - sourceValueSetUrl
        - targetValueSetUrl

    CodeSystemFile:
      type: object
      description: "Metadata for a code system file  for toFhir local terminology service"
      properties:
        id:
          type: string
          description: "unique id"
        name:
          type: string
          description: "Name of the file"
        codeSystem:
          type: string
          description: "Corresponding code system url"
      required:
        - id
        - name
        - codeSystem

    FhirMappingTask:
      description: "FHIR Mapping task instance"
      type: object
      properties:
        mappingRef:
          type: string
          description: "Canonical URL of the FhirMapping definition to execute"
          example: "https://aiccelerate.eu/fhir/mappings/pilot1/patient-mapping"
        sourceBinding:
          type: object
          description: "Provide details how to load each source data for the mapping"
          properties:
            source:
              anyOf:
                - $ref: "#/components/schemas/FileSystemSource"
                - $ref: "#/components/schemas/SqlSource"
                - $ref: "#/components/schemas/KafkaSource"

    SchedulingSettings:
      type: object
      description: "Cron expression showing the times of scheduled task needed. More info: https://www.sauronsoftware.it/projects/cron4j/"
      properties:
        cronExpression:
          type: string
          description: "A UNIX crontab-like pattern is a string split in five space separated parts"
        initialTime:
          type: string
          description: "If specified, toFhir generates a time range between initial time and next run time of task"
      required:
        - cronExpression

    DataProcessingSettings:
      type: object
      description: "Data source processing settings"
      properties:
        saveErroneousRecords:
          type: boolean
          description: "If true, erroneous records will be saved to archive folder with the same path as the input file"
        archiveMode:
          $ref: "#/components/schemas/ArchiveModes"
      required:
        - saveErroneousRecords
        - archiveMode

    ArchiveModes:
      type: string
      enum:
        - off
        - delete
        - archive

    ExecuteJobTask:
      type: object
      description: "The data transfer object to keep mapping urls to be executed and corresponding mapping error handling."
      properties:
        clearCheckpoints:
          type: boolean
        mappingUrls:
          description: "mapping urls of the mappingTask's that to be executed"
          type: array
          items:
            type: string

    Execution:
      type: object
      description: Executions of a mapping job
      properties:
        id:
          type: string
          description: "Identifier of the execution"
          example: "c531d5b0-40fc-42a9-8f2d-c6105e3a5d39"
        mappingUrls:
          type: array
          items:
            type: string
            description: "Url of the mapping runned in the execution"
            example: "https://aiccelerate.eu/fhir/mappings/pilot1/anesthesia-observations-mapping"
        startTime:
          type: string
          description: "Start time of the execution"
          example: "2024-01-26T10:19:39.538+03:00"
        errorStatus:
          type: string
          description: "Result of the the mapping job"
          enum:
            - "SUCCESS"
            - "FAILURE"
            - "PARTIAL_SUCCESS"
            - "STARTED"
    Log:
      type: object
      description: "Logs of the individual executions"
      properties:
        "@timestamp":
          type: string
          description: "Timestamp of the event"
          example: "2024-01-26T10:19:39.538+03:00"
        errorCode:
          type: string
          description: "Error code, if any"
        errorDesc:
          type: string
          description: "Error description, if any"
        errorExpr:
          type: string
          description: "Expression that causes error, if any"
        eventId:
          type: string
          description: "Identifier of the event"
          example: "MAPPING_JOB_RESULT"
        executionId:
          type: string
          description: "Identifier of the execution"
          example: "c531d5b0-40fc-42a9-8f2d-c6105e3a5d39"
        jobId:
          type: string
          description: "Identifier of the job"
          example: "pilot1"
        level:
          type: string
          description: "Level of the log"
          example: "INFO"
        logger_name:
          type: string
          description: "Name of the logger"
          example: "io.tofhir.engine.mapping.job.FhirMappingJobManager"
        mappedResource:
          type: string
          description: "Mapped resource, if any"
        mappingExpr:
          type: string
          description: "Mapping expression, if any"
        mappingUrl:
          type: string
          description: "URL of the mapping"
          example: "https://aiccelerate.eu/fhir/mappings/pilot1/anesthesia-observations-mapping"
        message:
          type: string
          description: "Log message"
          example: "toFHIR chunk mapping result (STARTED) for execution 'c531d5b0-40fc-42a9-8f2d-c6105e3a5d39' of job 'pilot1' in project 'pilot1'"
        numOfFailedWrites:
          type: integer
          description: "Number of failed writes, -1 if there is an error"
          example: -1
        numOfFhirResources:
          type: integer
          description: "Number of written FHIR resources, -1 if there is an error"
          example: -1
        numOfInvalids:
          type: integer
          description: "Number of invalid rows, -1 if there is an error"
          example: -1
        numOfNotMapped:
          type: integer
          description: "Number of not mapped rows, -1 if there is an error"
          example: -1
        projectId:
          type: string
          description: "Identifier of the project"
          example: "pilot1"
        result:
          type: string
          description: "Result of the mapping job"
          example: "STARTED"
        source:
          type: string
          description: "Source of the error, if any"
        stack_trace:
          type: string
          description: "Stack trace of the error, if any"
        error_logs:
          type: array
          description: "Logs of the errors, if any"
          items:
            $ref: "#/components/schemas/ErrorLog"
    ErrorLog:
      type: object
      description: "Logs of the errors"
      properties:
        errorCode:
          type: string
          description: "Error code"
          example: "mapping_error"
        errorDesc:
          type: string
          description: "Error description"
          example: "FHIR path expression returns empty although value is not marked as optional! Please use '?' mark in placeholder e.g. {{? <fhir-path-expression>}} or correct your expression"
        message:
          type: string
          description: "Detailed error message"
          example: "Mapping failure (mapping_error) for job 'pilot1' and mapping 'https://aiccelerate.eu/fhir/mappings/pilot1/condition-mapping' within expression 'Expression: result. Error: FHIR path expression returns empty although value is not marked as optional! Please use '?' mark in placeholder e.g. {{? <fhir-path-expression>}} or correct your expression' execution 'c531d5b0-40fc-42a9-8f2d-c6105e3a5d39'!\n\tSource: {\"pid\":\"p1\",\"code\":\"J13\",\"codeDisplay\":\"Pneumonia due to Streptococcus pneumoniae\",\"onsetDateTime\":\"2012-10-15\",\"abatementDateTime\":null,\"encounterId\":null,\"diagnosisType\":\"main\",\"isProlonged\":true,\"certainity\":\"confirmed\",\"asserter\":null}\n\tError: FHIR path expression returns empty although value is not marked as optional! Please use '?' mark in placeholder e.g. {{? <fhir-path-expression>}} or correct your expression\n\tExpression: Hello"
        mappingUrl:
          type: string
          description: "URL of the mapping"
          example: "https://aiccelerate.eu/fhir/mappings/pilot1/condition-mapping"

    TestResourceCreationRequest:
      type: object
      description: "FhirMappingTask and resource filter to test a mapping"
      properties:
        fhirMappingTask:
          allOf:
            - $ref: "#/components/schemas/FhirMappingTask"
          description: "task to be used for testing"
        resourceFilter:
          $ref: "#/components/schemas/ResourceFilter"

    ResourceFilter:
      description: "Resource filter config for testing a mapping"
      properties:
        numberOfRows:
          type: integer
          description: "number of rows to select"
          example: 10
        order:
          type: string
          description: "order of rows to select"
          example: "start"

    FhirPathFunction:
      type: object
      description: "the documentations of FhirPath functions"
      properties:
        documentation:
          type: string
        insertText:
          type: string
        detail:
          type: string
        label:
          type: string
        kind:
          type: string
        returnType:
          type: array
          items:
            type: string
        inputType:
          type: array
          items:
            type: string

    FilePathNode:
      type: object
      description: "Represent each file/folder in the file system, with the root being the context path where toFHIR runs."
      properties:
        label:
          type: string
        isFolder:
          type: boolean
        children:
          type: array
          items:
            $ref: '#/components/schemas/FilePathNode'

    Metadata:
      type: object
      description: "Model that represents the metadata of the server."
      properties:
        name:
          type: string
          description: "The name of the server."
        description:
          type: string
          description: "A description of the server."
        version:
          type: string
          description: "The current version of the server."
        majorFhirVersion:
          type: string
          description: "The major FHIR version of definitions (profiles, valuesets, codesystems) supported by the server."
        toFhirRedcapVersion:
          type: string
          description: "The optional toFHIR-Redcap server version."
        definitionsRootUrls:
          type: array
          items:
            type: string
          description: "Optional list of root URLs for definitions."
        schemasFhirVersion:
          type: string
          description: "The FHIR version used for schemas."
        repositoryNames:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/RepositoryNames'
          description: "The configured repository names."
        archiving:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/Archiving'
          description: "The archiving configuration."


    RepositoryNames:
      type: object
      description: "Represents the configured repository names included in the metadata."
      properties:
        mappings:
          type: string
          description: "The path to the folder where the mappings are kept."
        schemas:
          type: string
          description: "The path to the folder where the schema definitions are kept."
        contexts:
          type: string
          description: "The path to the folder where the mapping context files are kept."
        jobs:
          type: string
          description: "The path to the folder where the job definitions are kept."
        terminologySystems:
          type: string
          description: "The path to the folder where the terminology system definitions are kept."

    Archiving:
      type: object
      description: "Represents the archiving configurations included in the metadata."
      properties:
        erroneousRecordsFolder:
          type: string
          description: "The parent folder where the data sources of errors received while running mapping are stored."
        archiveFolder:
          type: string
          description: "The folder path where the archive of the processed source data is stored."
        streamArchivingFrequency:
          type: number
          description: "The period (in milliseconds) to run the archiving task for file streaming jobs."

  # HTTP responses for requests
  responses:
    400BadRequest:
      description: "Bad or Invalid request"
    409AlreadyExists:
      description: "Given object already exists"
    404NotFound:
      description: "Given resource does not exist"
    415UnsupportedMediaType:
      description: "Given resource is not a valid application/json instance"

  # Path and query parameters for requests
  parameters:
    projectId:
      in: path
      name: "projectId"
      required: true
      schema:
        type: string
        format: uuid
        pattern: "[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}"
      description: "Identifier of the project"

    schemaId:
      in: path
      name: "schemaId"
      required: true
      schema:
        type: string
        format: uuid
        pattern: "[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}"
      description: "Identifier of the schema"

    format:
      in: query
      name: "format"
      schema:
        type: string
        enum: [ "StructureDefinition", "SimpleStructureDefinition" ]
      description: "Requested format of the schema"

    schemaUrl:
      in: query
      name: url
      schema:
        type: string
        format: url
      description: "Url of the schema"
      example: "https://aiccelerate.eu/fhir/StructureDefinition/Ext-plt1-anesthesia-observations"

    rootUrl:
      in: query
      name: "rootUrl"
      schema:
        type: string
        format: url
      required: true
      description: "The root url of schemas to be created"

    mappingId:
      in: path
      name: "mappingId"
      schema:
        type: string
      required: true
      description: "Identifier of the mapping"

    jobId:
      in: path
      name: "jobId"
      schema:
        type: string
      required: true
      description: "Identifier of the job"

    executionId:
      name: executionId
      in: path
      required: true
      schema:
        type: string

    mappingUrl:
      in: path
      name: "mappingUrl"
      schema:
        type: string
        format: url
      required: true
      description: "Url of a mapping"

    mappingContextId:
      in: path
      name: "mappingContextId"
      schema:
        type: string
        format: file name
      required: true
      description: "Identifier of the mapping context"

    terminologyId:
      in: path
      name: "terminologyId"
      required: true
      schema:
        type: string
      description: "Identifier of the terminology"

    conceptMapId:
      in: path
      name: "conceptMapId"
      required: true
      schema:
        type: string
      description: "Identifier of the concept map"

    codeSystemId:
      in: path
      name: "codeSystemId"
      required: true
      schema:
        type: string
      description: "Identifier of the code system"

    q:
      name: q
      in: query
      required: true
      description: Query parameter
      schema:
        type: string

    rtype:
      name: rtype
      in: query
      description: Resource type (required for profiles query)
      schema:
        type: string

    profile:
      name: profile
      in: query
      description: Profile URL (required for elements query)
      schema:
        type: string

    fhirValidationUrl:
      name: fhirValidationUrl
      in: query
      required: true
      description: FHIR validation URL
      schema:
        type: string

  # Examples to use in the swagger api
  examples:
    # Example for FhirMappingExpression structure
    FhirExpressionExample:
      value:
        name: "result"
        language: "en"
        value:
          '{{#ind}}': '{{utl:evaluateExpression(utl:indices(1, 65).select(''iif(v'' & $this.toString() & ''.exists(), '' & $this.toString() & '', {})'').mkString('' | '')).select(''v'' & $this.toString())}}'
          '{{*}}':
            resourceType: Observation
            id: '{{mpp:getHashedId(''Observation'', pid & %ind & time.toString())}}'
            meta:
              profile:
                - https://aiccelerate.eu/fhir/StructureDefinition/AIC-AnesthesiaObservation
              source: '{{%sourceSystem.sourceUri}}'
            status: final
            code:
              coding:
                - system: '{{mpp:getConcept(%anstObsConceptMap, %ind, ''target_system'')}}'
                  code: '{{mpp:getConcept(%anstObsConceptMap, %ind, ''target_code'')}}'
                  display: '{{mpp:getConcept(%anstObsConceptMap, %ind, ''target_display'')}}'
            subject: '{{mpp:createFhirReferenceWithHashedId(''Patient'', pid)}}'
            encounter: '{{? mpp:createFhirReferenceWithHashedId(''Encounter'', encounterId)}}'
            effectiveDateTime: '{{time}}'
            valueQuantity:
              value: '{{utl:evaluateExpression(%ind)}}'
              unit: '{{mpp:getConcept(%anstObsConceptMap, %ind, ''target_unit'')}}'
              system: http://unitsofmeasure.org
              code: '{{mpp:getConcept(%anstObsConceptMap, %ind, ''target_unit'')}}'

    # Example response for the path: POST, /projects/{projectId}/jobs/{jobId}/test
    FhirValidationExample:
      value:
        resourceType: OperationOutcome
        issue:
          - severity: information
            code: informational
            diagnostics: All OK :)
            expression: []
          - severity: warning
            code: invalid
            diagnostics: '[Validating against ''https://aiccelerate.eu/fhir/StructureDefinition/AIC-AnesthesiaObservation''] => Constraint ''dom-6'' is not satisfied for the given value! Constraint Description: ''A resource should have narrative for robust management''. FHIR Path expression: ''text.`div`.exists()'''
            expression:
              - $this

    # Example response for the path: GET, /fhir-path-functions
    FhirPathFunctionsExample:
      value:
        - documentation: Generates an UUID
          insertText: utl:uuid()
          detail: utl
          label: utl:uuid
          kind: 1
          returnType:
            - string
          inputType: []
        - documentation: 'Returns the input string with all instances of pattern replaced with substitution. Ex: ''abcdefg''.replace(''cde'', ''123'')'
          insertText: replace(<patternExpr>,<substitutionExpr>)
          detail: ''
          label: replace
          kind: 0
          returnType:
            - string
          inputType:
            - string

    # Example response for the path: GET, /file-system-path
    FilePathNodeExample:
      value:
        label: test-data
        isFolder: true
        children:
          - label: icrc
            isFolder: true
            children:
              - label: encounters.csv
                isFolder: false
                children: []
              - label: patients.csv
                isFolder: false
                children: []
          - label: ucl
            isFolder: true
            children:
              - label: OBSERVATION.csv
                isFolder: false
                children: []
              - label: PERSON.csv
                isFolder: false
                children: []

    # Example response for the path: GET, /metadata
    MetadataExample:
      value:
        name: toFHIR
        description: toFHIR is a tool for mapping data from various sources to FHIR resources.
        version: 1.1-SNAPSHOT
        toFhirRedcapVersion: 1.1-SNAPSHOT
        majorFhirVersion: R5
        definitionsRootUrls:
          - https://datatools4heart.eu
        schemasFhirVersion: 5.0.0
        repositoryNames:
          mappings: mappings
          schemas: schemas
          contexts: mapping-contexts
          jobs: mapping-jobs
          terminologySystems: terminology-systems
        archiving:
          erroneousRecordsFolder: erroneous-records-folder
          archiveFolder: archive-folder
          streamArchivingFrequency: 5000

    # A simple structure definition example for schema post
    SimpleStructureDefinitionExample:
      value:
        id: Ext-plt1-condition-test
        url: https://aiccelerate.eu/fhir/StructureDefinition/Ext-plt1-condition-test
        type: Ext-plt1-condition-test
        name: Ext-plt1-condition-test
        rootDefinition:
          id: Ext-plt1-condition-test
          path: Ext-plt1-condition-test
          dataTypes:
            - dataType: Element
          isPrimitive: false
          isChoiceRoot: false
          isArray: false
          minCardinality: 0
        fieldDefinitions:
          - id: pid
            path: Ext-plt1-condition-test.pid
            dataTypes:
              - dataType: id
                profiles:
                  - http://hl7.org/fhir/StructureDefinition/id
            isPrimitive: true
            isChoiceRoot: false
            isArray: false
            minCardinality: 1
            maxCardinality: 1
            short: Patient identifier
            definition: Unique patient identifier  (a pseudoynm)
          - id: code
            path: Ext-plt1-condition-test.code
            dataTypes:
              - dataType: code
                profiles:
                  - http://hl7.org/fhir/StructureDefinition/code
            isPrimitive: true
            isChoiceRoot: false
            isArray: false
            minCardinality: 1
            maxCardinality: 1
            short: Condition code
            definition: ICD-10 code for diagnosis
          - id: codeDisplay
            path: Ext-plt1-condition-test.codeDisplay
            dataTypes:
              - dataType: string
                profiles:
                  - http://hl7.org/fhir/StructureDefinition/string
            isPrimitive: true
            isChoiceRoot: false
            isArray: false
            minCardinality: 0
            maxCardinality: 1
            short: Condition name
            definition: Name of the diagnosis
          - id: onsetDateTime
            path: Ext-plt1-condition-test.onsetDateTime
            dataTypes:
              - dataType: dateTime
                profiles:
                  - http://hl7.org/fhir/StructureDefinition/dateTime
            isPrimitive: true
            isChoiceRoot: false
            isArray: false
            minCardinality: 1
            maxCardinality: 1
            short: Condition start date
            definition: 'When this condition is started or diagnosis is set. '
          - id: abatementDateTime
            path: Ext-plt1-condition-test.abatementDateTime
            dataTypes:
              - dataType: dateTime
                profiles:
                  - http://hl7.org/fhir/StructureDefinition/dateTime
            isPrimitive: true
            isChoiceRoot: false
            isArray: false
            minCardinality: 0
            maxCardinality: 1
            short: Condition abatement date
            definition: If the disease is resolved/no longer active, the end date.
          - id: encounterId
            path: Ext-plt1-condition-test.encounterId
            dataTypes:
              - dataType: id
                profiles:
                  - http://hl7.org/fhir/StructureDefinition/id
            isPrimitive: true
            isChoiceRoot: false
            isArray: false
            minCardinality: 0
            maxCardinality: 1
            short: Encounter
            definition: Unique identifier of the visit/encounter that this diagnosis is set (if exists and related)

    # A structure definition example for schema post
    StructureDefinitionExample:
      value:
        resourceType: StructureDefinition
        url: https://aiccelerate.eu/fhir/StructureDefinition/Ext-plt1-operation-episode
        name: Ext-plt1-operation-episode
        status: draft
        fhirVersion: 4.0.1
        kind: logical
        abstract: false
        type: Ext-plt1-operation-episode
        baseDefinition: http://hl7.org/fhir/StructureDefinition/Element
        derivation: specialization
        differential:
          element:
            - id: Ext-plt1-operation-episode
              path: Ext-plt1-operation-episode
              min: 0
              max: '*'
              type:
                - code: Element
            - id: Ext-plt1-operation-episode.pid
              path: Ext-plt1-operation-episode.pid
              short: Patient identifier
              definition: Unique patient identifier  (a pseudoynm)
              min: 1
              max: '1'
              type:
                - code: id
                  profile:
                    - http://hl7.org/fhir/StructureDefinition/id
            - id: Ext-plt1-operation-episode.episodeId
              path: Ext-plt1-operation-episode.episodeId
              short: Episode identifier
              definition: Unique identifier of the episode of care that surgery is performed
              min: 1
              max: '1'
              type:
                - code: id
                  profile:
                    - http://hl7.org/fhir/StructureDefinition/id